<?xml version="1.0" ?>
<launch>

  <!-- declare arg to be passed in -->
  <arg name="map" default=""/>
  <arg name="file" default=""/>
  <arg name="legacy" default="false" />
  <arg name="load_map_from_file" default="false" />

  <arg name="machine" default="localhost" />
  <arg name="user" default="" />

  <!-- The planner being used by move_base. STRANDS systems tend to use DWAPlannerROS Jackal and HSR TrajectoryPlannerROS.  -->
  <arg name="move_base_planner" default="move_base/DWAPlannerROS"/>
  <!-- What action is being used for move_base -->
  <arg name="move_base_name" default="move_base"/>

  <machine name="$(arg machine)" address="$(arg machine)" env-loader="$(optenv ROS_ENV_LOADER )" user="$(arg user)" default="true"/>

  <node pkg="topological_navigation" type="map_manager.py" name="topological_map_manager" args="-f $(arg file)" respawn="true" if="$(eval arg('legacy') and arg('load_map_from_file'))"/>
  <node pkg="topological_navigation" type="map_manager.py" name="topological_map_manager" args="$(arg map)" respawn="true" if="$(eval arg('legacy') and not arg('load_map_from_file'))"/>
  <node pkg="topological_navigation" type="map_manager2.py" name="topological_map_manager" args="$(arg file)" respawn="true" unless="$(arg legacy)"/>

  <node pkg="fremenserver" type="fremenserver" name="fremenserver" respawn="true" unless="$(arg load_map_from_file)"/>

  <node pkg="topological_navigation" name="topological_localisation" type="localisation.py" output="screen" respawn="true" unless="$(arg load_map_from_file)"/>
  <!-- TODO: remove this when tag functionality is MongoDB independant -->
  <node pkg="topological_navigation" name="topological_localisation" type="localisation.py" args="-notags" output="screen" respawn="true" if="$(arg load_map_from_file)"/>
	
  <node pkg="topological_navigation" name="topological_navigation" type="navigation.py" output="screen" respawn="true">
    <param name="retries" type="int" value="$(arg topological_navigation_retries)"/>
    <param name="move_base_reconf_service" type="str" value="$(arg move_base_reconf_service)"/>
  </node>

  <node pkg="topological_navigation" type="navstats_loger.py" name="topological_navstats_logger" respawn="true" unless="$(arg load_map_from_file)"/>
		
  <node pkg="topological_navigation" type="visualise_map.py" name="visualise_map" args="$(arg map)" respawn="true" unless="$(arg load_map_from_file)"/>
  <node pkg="topological_navigation" type="visualise_map.py" name="visualise_map" args="$(arg map) -n" respawn="true" if="$(arg load_map_from_file)"/>
	
  <node pkg="topological_navigation" type="travel_time_estimator.py" name="travel_time_estimator" respawn="true" unless="$(arg load_map_from_file)"/>
  <node pkg="topological_navigation" type="topological_prediction.py" name="topological_prediction" output="screen" respawn="true" unless="$(arg load_map_from_file)"/>

</launch>
